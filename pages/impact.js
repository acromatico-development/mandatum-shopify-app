import { Page } from "@shopify/polaris";
import { useAppBridge } from "@shopify/app-bridge-react";
import { useEffect, useState } from "react";
import { useQuery } from "react-apollo";

import { APP_DATA } from "../helpers/queries";

const Impact = ({impactData: {
  id,
  shop,
  orders,
  donations,
  carbon,
  land
}}) => {
  const app = useAppBridge();
  const { data: appData, loading: appLoading, error: appError } = useQuery(
    APP_DATA,
    {
      fetchPolicy: "no-cache",
    }
  );

  useEffect(() => {
    if(!appLoading && !appError && appData){
      const suscription = appData.app.installation.activeSubscriptions[0].id;
      const usageData = appData.app.installation.activeSubscriptions[0].lineItems[0].usageRecords.edges;
      console.log("Usage Records: ", usageData);
    }
  }, appData, appLoading, appError);

  return (
    <Page title="Community Impact">
      <div className="grid-container">
        <div className="grid-element">
          <svg viewBox="0 0 512 512">
            <defs>
              <clipPath id="clip0">
                <rect x="384" y="416" width="512" height="512"/>
              </clipPath>
            </defs>
            <g clip-path="url(#clip0)" transform="translate(-384 -416)">
              <path d="M856.916 640 832.007 640C829.092 629.447 819.537 622.103 808.59 622L782 622 782 556.976C782.061 554.499 780.782 552.182 778.654 550.914L591.077 442.572C588.925 441.321 586.267 441.321 584.115 442.572L396.48 550.914C394.319 552.167 392.992 554.478 393 556.976L393 773.661C393 776.162 394.334 778.473 396.5 779.723L584.154 888.065C585.218 888.679 586.425 889.003 587.654 889.003 588.915 889.004 590.154 888.681 591.254 888.065L690 831.108 690 872.282C689.957 888.653 703.194 901.958 719.565 902.001 719.674 902.001 719.782 902.001 719.891 902L856.916 902C873.377 902.153 886.846 888.933 886.999 872.471 886.999 872.408 887 872.345 887 872.282L887 670.182C886.99 653.555 873.543 640.064 856.916 640ZM808.839 636C814.451 636 819 640.549 819 646.161L819 646.839C819 652.451 814.451 657 808.839 657L768.161 657C762.549 657 758 652.451 758 646.839L758 646.161C758 640.549 762.549 636 768.161 636ZM587.654 456.717 665.628 501.735 491.986 601.987 414.013 556.969ZM581 869.878 407 769.619 407 569.085 581 669.344ZM587.654 657.22 505.986 610.069 679.628 509.818 761.3 556.969ZM690 670.182 690 814.943 595 869.878 595 669.344 768 569.085 768 622 768.217 622C757.269 622.103 747.715 629.447 744.8 640L719.891 640C703.302 640.08 689.92 653.593 690 670.182ZM873 872.282C872.96 881.004 865.857 888.042 857.135 888.003 857.062 888.002 856.989 888.001 856.916 888L719.891 888C711.261 888.145 704.147 881.267 704.002 872.637 704 872.519 703.999 872.4 704 872.282L704 670.182C703.911 661.334 711.012 654.089 719.861 654 719.871 654 719.881 654 719.891 654L745.073 654C748.157 664.177 757.583 671.102 768.217 671L808.59 671C819.224 671.102 828.65 664.177 831.733 654L856.916 654C865.814 654.056 872.998 661.284 873 670.182Z" fill="#C55A11"/>
              <path d="M727.949 741 735.276 741C739.142 741 742.276 737.866 742.276 734 742.276 730.134 739.142 727 735.276 727L735 727 735 708 754.307 708C755.21 710.893 757.933 712.827 760.962 712.727 764.832 712.738 767.981 709.613 768 705.743L768 701.033C767.967 697.146 764.811 694.009 760.924 694L727.949 694C724.091 694.02 720.98 697.163 721 701.021 721 701.025 721 701.029 721 701.033L721 734.008C720.977 737.846 724.07 740.977 727.908 741 727.922 741 727.935 741 727.949 741Z" fill="#C55A11"/>
              <path d="M728 805 761 805C764.866 805 768 801.866 768 798L768 765C768 761.134 764.866 758 761 758L728 758C724.134 758 721 761.134 721 765L721 798C721 801.866 724.134 805 728 805ZM735 772 754 772 754 791 735 791Z" fill="#C55A11"/>
              <path d="M735.277 855 735 855 735 836 753.929 836C754.005 839.886 757.217 842.974 761.103 842.898 764.876 842.823 767.918 839.787 768 836.014L768 829.269C767.985 825.335 764.856 822.121 760.924 822L727.949 822C724.042 822.131 720.955 825.36 721 829.269L721 862.244C720.996 865.973 724.016 868.999 727.745 869.003 727.813 869.003 727.881 869.002 727.949 869L735.277 869C739.143 869 742.277 865.866 742.277 862 742.277 858.134 739.143 855 735.277 855Z" fill="#C55A11"/>
              <path d="M777.041 702.592 756.541 723.092 750.305 716.855C747.571 714.121 743.139 714.121 740.405 716.855 737.671 719.589 737.671 724.021 740.405 726.755L751.592 737.941C754.326 740.675 758.758 740.675 761.492 737.942 761.492 737.941 761.492 737.941 761.492 737.941L786.944 712.489C789.678 709.755 789.678 705.323 786.944 702.589 784.21 699.855 779.778 699.855 777.044 702.589Z" fill="#C55A11"/>
              <path d="M777.041 831.841 756.541 852.341 750.305 846.104C747.571 843.37 743.139 843.37 740.405 846.104 737.671 848.838 737.671 853.27 740.405 856.004L751.592 867.19C754.326 869.924 758.758 869.924 761.492 867.191 761.492 867.19 761.492 867.19 761.492 867.19L786.944 841.738C789.678 839.004 789.678 834.572 786.944 831.838 784.21 829.104 779.778 829.104 777.044 831.838Z" fill="#C55A11"/>
              <path d="M848.857 711 804.891 711C801.025 711 797.891 714.134 797.891 718 797.891 721.866 801.025 725 804.891 725L848.857 725C852.723 725 855.857 721.866 855.857 718 855.857 714.134 852.723 711 848.857 711Z" fill="#C55A11"/>
              <path d="M848.857 775 804.891 775C801.025 775 797.891 778.134 797.891 782 797.891 785.866 801.025 789 804.891 789L848.857 789C852.723 789 855.857 785.866 855.857 782 855.857 778.134 852.723 775 848.857 775Z" fill="#C55A11"/>
              <path d="M848.857 839 804.891 839C801.025 839 797.891 842.134 797.891 846 797.891 849.866 801.025 853 804.891 853L848.857 853C852.723 853 855.857 849.866 855.857 846 855.857 842.134 852.723 839 848.857 839Z" fill="#C55A11"/>
            </g>
          </svg>
          <h3>Total Orders</h3>
          <p className="overview">{orders}</p>
        </div>
        <div className="grid-element">
          <svg viewBox="0 0 512 512">
            <defs>
              <clipPath id="clip0">
                <rect x="384" y="416" width="512" height="512"/>
              </clipPath>
            </defs>
            <g clip-path="url(#clip0)" transform="translate(-384 -416)">
              <path d="M634.958 511.667 638.655 511.667C639.092 511.746 639.54 511.794 640 511.794 640.46 511.794 640.908 511.746 641.345 511.667L660.167 511.667C664.31 511.667 667.667 508.31 667.667 504.167 667.667 500.024 664.31 496.667 660.167 496.667L647.5 496.667 647.5 489.142C647.5 484.999 644.143 481.642 640 481.642 635.857 481.642 632.5 484.999 632.5 489.142L632.5 496.803C621.177 498.032 612.333 507.647 612.333 519.292 612.333 531.768 622.482 541.918 634.958 541.918L645.042 541.918C649.246 541.918 652.667 545.339 652.667 549.543 652.667 553.747 649.246 557.168 645.042 557.168L619.833 557.168C615.69 557.168 612.333 560.525 612.333 564.668 612.333 568.811 615.69 572.168 619.833 572.168L632.5 572.168 632.5 580.06C632.5 584.203 635.857 587.56 640 587.56 644.143 587.56 647.5 584.203 647.5 580.06L647.5 572.033C658.823 570.804 667.667 561.189 667.667 549.544 667.667 537.068 657.518 526.919 645.042 526.919L634.958 526.919C630.754 526.919 627.333 523.498 627.333 519.293 627.333 515.088 630.754 511.667 634.958 511.667Z" fill="#767171"/>
              <path d="M825.878 600.846 738.033 600.846C751.259 581.345 758.418 558.254 758.418 534.418 758.418 469.122 705.296 416 640 416 574.704 416 521.582 469.122 521.582 534.418 521.582 558.253 528.742 581.344 541.968 600.846L454.122 600.846C449.979 600.846 446.622 604.203 446.622 608.346L446.622 679.061C446.622 683.204 449.979 686.561 454.122 686.561L470.833 686.561 470.846 729.342C470.847 733.484 474.204 736.84 478.346 736.84L478.348 736.84C482.491 736.839 485.847 733.48 485.846 729.338L485.832 686.561 794.1 686.561 794.114 729.342C794.115 733.484 797.472 736.84 801.614 736.84L801.616 736.84C805.759 736.839 809.115 733.48 809.114 729.338L809.101 686.561 825.879 686.561C830.022 686.561 833.379 683.204 833.379 679.061L833.379 608.346C833.378 604.203 830.021 600.846 825.878 600.846ZM536.582 534.418C536.582 477.394 582.976 431 640 431 697.024 431 743.418 477.394 743.418 534.418 743.418 558.785 734.836 582.25 719.231 600.846L687.034 600.846C707.834 586.075 721.445 561.814 721.445 534.418 721.445 489.509 684.909 452.973 640 452.973 595.091 452.973 558.555 489.509 558.555 534.418 558.555 561.814 572.166 586.075 592.966 600.846L560.768 600.846C545.164 582.249 536.582 558.785 536.582 534.418ZM639.346 600.846C603.01 600.492 573.555 570.836 573.555 534.418 573.555 497.78 603.363 467.973 640 467.973 676.637 467.973 706.445 497.781 706.445 534.418 706.445 570.836 676.99 600.492 640.654 600.846ZM818.378 671.561 461.622 671.561 461.622 615.846 818.378 615.846Z" fill="#767171"/>
              <path d="M801.622 757.064C801.621 757.064 801.62 757.064 801.62 757.064 797.477 757.065 794.121 760.424 794.122 764.566L794.167 913 485.9 913 485.859 764.562C485.858 760.42 482.501 757.064 478.359 757.064L478.357 757.064C474.214 757.065 470.858 760.424 470.859 764.566L470.902 920.502C470.903 924.644 474.26 928 478.402 928L801.669 928C803.658 928 805.566 927.21 806.973 925.803 808.38 924.396 809.17 922.488 809.169 920.498L809.122 764.562C809.121 760.421 805.764 757.064 801.622 757.064Z" fill="#767171"/>
              <path d="M640.071 884.562C641.99 884.562 643.91 883.83 645.375 882.366L714.644 813.097C733.323 794.417 733.323 764.023 714.644 745.343 695.964 726.664 665.572 726.665 646.89 745.344L640.072 752.163 633.253 745.343C624.204 736.295 612.173 731.312 599.377 731.312 586.58 731.312 574.549 736.295 565.5 745.343 546.821 764.023 546.821 794.417 565.5 813.097L634.769 882.366C636.232 883.829 638.152 884.562 640.071 884.562ZM576.106 755.95C582.521 749.534 590.948 746.326 599.376 746.326 607.803 746.326 616.23 749.534 622.645 755.95L634.768 768.073C636.175 769.479 638.082 770.269 640.072 770.269 642.062 770.269 643.969 769.479 645.376 768.072L657.497 755.95C670.331 743.119 691.209 743.12 704.037 755.95 716.868 768.781 716.868 789.658 704.037 802.489L640.072 866.455 576.107 802.489C563.275 789.658 563.275 768.781 576.106 755.95Z" fill="#767171"/>
            </g>
          </svg>
          <h3>Donations</h3>
          <p className="overview">$ {donations}</p>
        </div>
        <div className="grid-element">
          <svg viewBox="0 0 512 512">
            <defs>
              <clipPath id="clip0">
                <rect x="384" y="416" width="512" height="512"/>
              </clipPath>
            </defs>
            <g clip-path="url(#clip0)" transform="translate(-384 -416)">
              <path d="M864.175 700.298C890.675 641.722 847.098 574.924 782.536 576.021 772.688 522.407 716.401 490.254 665.045 509.631 638.451 485.327 604.199 472.008 568 472.008 481.783 472.008 414.741 547.524 425.037 633.354 398.896 654.729 384 686.047 384 720.008 384 800.552 466.676 854.358 539.86 823.088 594.729 885.532 689.235 887.823 747.607 831.983 763.876 847.344 785.447 856.008 808 856.008 856.523 856.008 896 816.531 896 768.008 896 741.782 884.218 716.951 864.175 700.298ZM808 840.008C787.196 840.008 767.407 830.989 753.707 815.265 750.549 811.64 744.99 811.655 741.813 815.077 688.924 872.034 597.514 869.348 548.283 808.254 545.931 805.334 541.866 804.441 538.506 806.103 475.256 837.397 400 791.352 400 720.008 400 689.537 413.992 661.546 438.389 643.212 440.746 641.441 441.938 638.517 441.49 635.603 429.549 557.807 489.866 488.008 568 488.008 601.756 488.008 633.611 501.041 657.697 524.705 660.047 527.014 663.572 527.646 666.578 526.298 710.729 506.492 762.97 535.111 767.669 585.192 767.868 587.318 768.91 589.277 770.561 590.631 774.115 593.545 776.536 592.008 784 592.008 838.735 592.008 873.435 651.007 847.064 698.755 845.092 702.325 846.122 706.807 849.454 709.158 868.581 722.66 880 744.66 880 768.008 880 807.709 847.701 840.008 808 840.008Z" fill="#548235"/>
              <path d="M732 648.008C716.561 648.008 704 660.569 704 676.008L704 680.008C704 684.426 707.582 688.008 712 688.008 716.418 688.008 720 684.426 720 680.008L720 676.008C720 669.391 725.383 664.008 732 664.008 744.432 664.008 748.407 680.834 738.174 686.974L717.593 699.322C709.208 704.354 703.999 713.553 703.999 723.332L703.999 736.008C703.999 740.426 707.581 744.008 711.999 744.008L751.999 744.008C756.417 744.008 759.999 740.426 759.999 736.008 759.999 731.59 756.417 728.008 751.999 728.008L719.999 728.008 719.999 723.332C719.999 719.141 722.231 715.198 725.825 713.042L746.406 700.694C754.504 695.835 760 687.018 760 676.008 760 660.569 747.439 648.008 732 648.008Z" fill="#548235"/>
              <path d="M640 608.008C613.533 608.008 592 629.541 592 656.008L592 696.008C592 722.475 613.533 744.008 640 744.008 666.467 744.008 688 722.475 688 696.008L688 656.008C688 629.541 666.467 608.008 640 608.008ZM672 696.008C672 713.653 657.645 728.008 640 728.008 622.355 728.008 608 713.653 608 696.008L608 656.008C608 638.363 622.355 624.008 640 624.008 657.645 624.008 672 638.363 672 656.008Z" fill="#548235"/>
              <path d="M567.861 704.677C563.814 702.911 559.097 704.758 557.328 708.807 552.235 720.471 540.723 728.008 527.999 728.008 510.354 728.008 495.999 713.653 495.999 696.008L495.999 656.008C495.999 627.415 530.638 613.4 550.623 633.385 553.472 636.234 555.727 639.537 557.327 643.205 559.094 647.256 563.808 649.107 567.858 647.34 571.908 645.574 573.759 640.859 571.993 636.809 569.59 631.298 566.206 626.339 561.937 622.07 531.971 592.104 480 613.107 480 656.008L480 696.008C480 722.475 501.533 744.008 528 744.008 547.085 744.008 564.353 732.704 571.992 715.209 573.76 711.161 571.911 706.445 567.861 704.677Z" fill="#548235"/>
            </g>
          </svg>
          <h3>Carbon Credits</h3>
          <p className="overview">{carbon} tCO2e</p>
        </div>
        <div className="grid-element">
          <svg viewBox="0 0 412 412">
            <defs>
              <clipPath id="clip0">
                <rect x="434" y="466" width="412" height="412"/>
              </clipPath>
            </defs>
            <g clip-path="url(#clip0)" transform="translate(-434 -466)">
              <path d="M672.143 507.281C672.143 502.307 676.174 498.275 681.148 498.275L683.292 498.275C688.267 498.275 692.298 502.307 692.298 507.281 692.298 512.255 688.267 516.286 683.292 516.286L681.148 516.286C676.175 516.286 672.143 512.255 672.143 507.281ZM684.569 716.627C684.569 721.601 688.601 725.633 693.575 725.633L695.719 725.633C700.693 725.633 704.725 721.601 704.725 716.627 704.725 711.653 700.693 707.622 695.719 707.622L693.575 707.622C688.602 707.622 684.569 711.653 684.569 716.627ZM694.648 675.347C717.409 675.347 735.927 693.865 735.927 716.627 735.927 736.297 722.099 752.798 703.653 756.918L703.653 784.265C703.653 789.239 699.622 793.27 694.648 793.27 689.673 793.27 685.642 789.239 685.642 784.265L685.642 756.918C667.195 752.799 653.366 736.298 653.366 716.627 653.366 693.865 671.884 675.347 694.648 675.347ZM694.648 693.358C681.817 693.358 671.377 703.797 671.377 716.627 671.377 729.457 681.817 739.897 694.648 739.897 707.478 739.897 717.916 729.457 717.916 716.627 717.916 703.797 707.478 693.358 694.648 693.358ZM549.607 596.818C549.607 574.055 568.127 555.537 590.89 555.537 613.653 555.537 632.172 574.055 632.172 596.818 632.172 616.487 618.342 632.988 599.896 637.11L599.896 664.455C599.896 669.429 595.864 673.46 590.89 673.46 585.916 673.46 581.884 669.429 581.884 664.455L581.884 637.11C563.439 632.989 549.607 616.488 549.607 596.818ZM567.618 596.818C567.618 609.649 578.058 620.087 590.89 620.087 603.721 620.087 614.16 609.649 614.16 596.818 614.16 583.987 603.721 573.548 590.89 573.548 578.058 573.548 567.618 583.987 567.618 596.818ZM640.939 507.281C640.939 484.519 659.458 466 682.22 466 704.983 466 723.502 484.519 723.502 507.281 723.502 526.95 709.672 543.451 691.225 547.573L691.225 574.918C691.225 579.892 687.194 583.924 682.22 583.924 677.246 583.924 673.214 579.892 673.214 574.918L673.214 547.572C654.769 543.451 640.939 526.95 640.939 507.281ZM658.95 507.281C658.95 520.112 669.389 530.55 682.22 530.55 695.051 530.55 705.49 520.112 705.49 507.281 705.49 494.45 695.051 484.011 682.22 484.011 669.389 484.011 658.95 494.45 658.95 507.281ZM793.244 621.667 778.167 616.21 765.745 531.152C764.267 521.023 758.656 512.634 749.945 507.53 745.652 505.013 740.136 506.458 737.623 510.748 735.108 515.039 736.549 520.556 740.84 523.07 744.905 525.452 747.221 528.945 747.923 533.753L761.124 624.146C761.603 627.429 763.85 630.182 766.97 631.312L787.114 638.604C800.923 643.602 802.283 647.048 801.927 649.492L780.255 797.881C779.236 804.857 774.64 809.284 766.589 811.04L629.995 840.838C628.781 841.102 627.836 840.902 626.723 840.148 623.755 838.139 621.05 832.936 620.142 827.499L619.415 823.137C618.975 820.499 617.386 818.194 615.078 816.844 612.768 815.491 609.981 815.24 607.466 816.149L486.778 859.831C485.06 860.455 482.896 858.809 482.272 858.291 479.404 855.901 477.597 851.962 478.07 849.126L519.916 598.506C520.934 592.4 524.263 586.607 527.494 585.317 532.114 583.474 534.364 578.235 532.519 573.616 530.675 568.996 525.435 566.742 520.818 568.591 509.623 573.059 503.834 585.443 502.151 595.542L460.305 846.16C458.767 855.375 462.867 865.568 470.748 872.131 475.39 875.997 480.669 878 485.91 878 488.271 878 490.625 877.594 492.909 876.767L603.847 836.613C606.341 844.524 610.895 851.184 616.622 855.063 621.831 858.59 627.783 859.755 633.832 858.436L770.426 828.638C785.878 825.268 795.957 815.006 798.075 800.484L819.747 652.096C822.638 632.308 801.283 624.578 793.244 621.667ZM589.821 605.823 591.964 605.823C596.938 605.823 600.969 601.792 600.969 596.818 600.969 591.844 596.938 587.812 591.964 587.812L589.821 587.812C584.847 587.812 580.816 591.844 580.816 596.818 580.816 601.792 584.847 605.823 589.821 605.823ZM572.872 538.919C573.374 539.004 573.873 539.044 574.366 539.044 578.687 539.044 582.503 535.924 583.237 531.52L587.809 504.138C588.718 498.697 591.423 493.495 594.391 491.485 595.505 490.732 596.453 490.532 597.664 490.796L619.971 495.663C624.832 496.726 629.629 493.642 630.689 488.783 631.749 483.924 628.668 479.126 623.809 478.066L601.503 473.199C595.454 471.881 589.501 473.045 584.293 476.573 577.133 481.421 571.806 490.616 570.045 501.171L565.473 528.553C564.654 533.459 567.966 538.101 572.872 538.919Z" fill="#BF9000"/>
            </g>
          </svg>
          <h3>Protected Area</h3>
          <p className="overview">{land} ha</p>
        </div>
      </div>
    </Page>
  );
};

export default Impact;

export async function getServerSideProps(context) {
  console.log("Shop: ", context.query.shop);
  const res = await fetch(`${APP_HOST}/getImpact?shop=${context.query.shop}`);
  const data = await res.json();

  if (!data) {
    return {
      notFound: true,
    }
  }

  console.log("Impact Data: ", data);

  return {
    props: data, // will be passed to the page component as props
  }
}
